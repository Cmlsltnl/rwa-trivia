<GridLayout [class.dialogOpen]="dialogOpen">
  <StackLayout margin="0 12 0 12">
    <FlexboxLayout class="game-result">
      <Label text="Game result" class="game-result-title"></Label>
      <GridLayout rows="auto" columns="auto" width="100%" marginTop="7">
        <Label row="0" col="0" text="{{game.round}}/{{totalRound}}" class="main-title"></Label>
        <StackLayout row="0" col="0" horizontalAlignment="left" class="game-round-info-container-grey">
        </StackLayout>
        <StackLayout row="0" col="0" horizontalAlignment="left" verticalAlignment="center"
          class="game-round-info-container"
          width="{{game.round/totalRound > 0 ? ((game.round/totalRound) * 100) : 0}}%">
        </StackLayout>
      </GridLayout>
    </FlexboxLayout>
    <GridLayout *ngIf="user" height="100%">
      <ScrollView>
        <StackLayout>
          <render-box>
            <StackLayout>
              <StackLayout (onloaded)="stackLoaded($event)">
                <StackLayout [backgroundColor]="stackBackgroundColor">
                  <!-- <Label class="category" horizontalAlignment="center" text="{{categoryName}}"
                                textWrap="true"></Label>
                            <Label *ngIf="game.gameOptions.playerMode == PlayerMode.Opponent" class="round"
                                horizontalAlignment="center" text="Round {{game.round}}/{{totalRound}}"
                                textWrap="true"></Label> -->

                  <StackLayout *ngIf="game.gameOptions?.playerMode == PlayerMode.Single" class="game-continue">

                    <StackLayout marginBottom="10">
                      <StackLayout *ngIf="
                                    (game.gameOptions?.playerMode != PlayerMode.Single && 
                                     game.round < 16 &&
                                     game.stats[user.userId]?.score > game.stats[otherUserId]?.score)
                                    ||
                                    (game.gameOptions?.playerMode == PlayerMode.Single &&
                                     game.playerQnAs?.length - game.stats[user.userId]?.score !== 4)" margin="15"
                        horizontalAlignment="center">
                        <Image src="~/assets/images/win.png" width="80" height="80" marginBottom="10">
                        </Image>
                        <Label class="gamestatus-username Roboto-Bold" text="{{playerUserName}} Won" textWrap="true"
                          marginLeft="10"></Label>
                      </StackLayout>
                      <StackLayout *ngIf="
                                    (game.gameOptions?.playerMode != PlayerMode.Single &&
                                     game.round < 16 &&
                                     game.stats[user.userId]?.score < game.stats[otherUserId]?.score)
                                    ||
                                    (game.gameOptions?.playerMode == PlayerMode.Single &&
                                     game.playerQnAs?.length - game.stats[user.userId]?.score === 4)" margin="15"
                        horizontalAlignment="center">
                        <Image src="~/assets/images/win.png" width="80" height="80" marginBottom="10">
                        </Image>
                        <Label class="gamestatus-username Roboto-Bold" color="#F44336" text="{{playerUserName}} Lost"
                          textWrap="true" marginLeft="10"></Label>
                      </StackLayout>
                    </StackLayout>

                    <Label class="roundandscore" horizontalAlignment="center"
                      text="{{playerUserName}} {{playerUserName === 'You' ? 'have' : 'has'}} collected {{game.stats[user.userId]?.score >= 5 ? 'all the badges':''}}"
                      textWrap="true"></Label>
                    <FlexboxLayout class="earnedsymbolsStack" horizontalAlignment="center">
                      <Image src="{{game.stats[user.userId]?.score>=1 ? 'res://badge1' : 'res://badge1inactive'}}"
                        class="score-image" height="20" width="20" verticalAlignment="center">
                      </Image>
                      <Image src="{{game.stats[user.userId]?.score>=2 ? 'res://badge2' : 'res://badge2inactive'}}"
                        class="score-image" height="20" width="20" verticalAlignment="center">
                      </Image>
                      <Image src="{{game.stats[user.userId]?.score>=3 ? 'res://badge3' : 'res://badge3inactive'}}"
                        class="score-image" height="20" width="20" verticalAlignment="center">
                      </Image>
                      <Image src="{{game.stats[user.userId]?.score>=4 ? 'res://badge4' : 'res://badge4inactive'}}"
                        class="score-image" height="20" width="20" verticalAlignment="center">
                      </Image>
                      <Image src="{{game.stats[user.userId]?.score>=5 ? 'res://badge5' : 'res://badge5inactive'}}"
                        class="score-image" height="20" width="20" verticalAlignment="center">
                      </Image>
                    </FlexboxLayout>
                  </StackLayout>

                  <GridLayout rows="*,*" columns="*,auto,*" horizontalAlignment="center"
                    *ngIf="game.gameOptions.playerMode == PlayerMode.Opponent">
                    <StackLayout marginTop="10" row="0" col="0" class="game-continue">
                      <app-user-card [userId]="user.userId" [otherInfo]="{ 'isScreenShot': isScreenShot ? 'true' : 'false','isWinner': (game.gameOptions?.playerMode != PlayerMode.Single && 
                                            game.round < 16 &&
                                            game.stats[user.userId]?.score > game.stats[otherUserId]?.score)
                                           ||
                                           (game.gameOptions?.playerMode == PlayerMode.Single &&
                                            game.playerQnAs?.length - game.stats[user.userId]?.score !== 4)}"
                        [type]="userCardType.USER_IMAGE_NAME_VERTICAL_GAME_OVER">
                      </app-user-card>
                      <!-- <Label class="roundandscore tagging" horizontalAlignment="center"
                                        text="Score {{game.stats[user.userId]?.score}}" textWrap="true"> </Label> -->
                      <FlexboxLayout class="earnedsymbolsStack" horizontalAlignment="center">
                        <Image src="{{game.stats[user.userId]?.score>=1 ? 'res://badge1' : 'res://badge1inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                        <Image src="{{game.stats[user.userId]?.score>=2 ? 'res://badge2' : 'res://badge2inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                        <Image src="{{game.stats[user.userId]?.score>=3 ? 'res://badge3' : 'res://badge3inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                        <Image src="{{game.stats[user.userId]?.score>=4 ? 'res://badge4' : 'res://badge4inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                        <Image src="{{game.stats[user.userId]?.score>=5 ? 'res://badge5' : 'res://badge5inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                      </FlexboxLayout>
                    </StackLayout>

                    <Label row="0" col="1" text="VS" class="vs-text" verticalAlignment="center" textWrap="true">
                    </Label>

                    <StackLayout marginTop="10" row="0" col="2" class="game-continue">
                      <app-user-card [userId]="otherUserId" [otherInfo]="{'isWinner': (game.gameOptions?.playerMode != PlayerMode.Single &&
                                            game.round < 16 &&
                                            game.stats[user.userId]?.score < game.stats[otherUserId]?.score)
                                           ||
                                           (game.gameOptions?.playerMode == PlayerMode.Single &&
                                            game.playerQnAs?.length - game.stats[user.userId]?.score === 4)}"
                        [type]="userCardType.USER_IMAGE_NAME_VERTICAL_GAME_OVER">
                      </app-user-card>
                      <!-- <Label class="roundandscore tagging" horizontalAlignment="center"
                                        text="Score {{game.stats[otherUserId]?.score}}" textWrap="true"> </Label> -->
                      <FlexboxLayout class="earnedsymbolsStack" horizontalAlignment="center">
                        <Image src="{{game.stats[otherUserId]?.score>=1 ? 'res://badge1' : 'res://badge1inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                        <Image src="{{game.stats[otherUserId]?.score>=2 ? 'res://badge2' : 'res://badge2inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                        <Image src="{{game.stats[otherUserId]?.score>=3 ? 'res://badge3' : 'res://badge3inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                        <Image src="{{game.stats[otherUserId]?.score>=4 ? 'res://badge4' : 'res://badge4inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                        <Image src="{{game.stats[otherUserId]?.score>=5 ? 'res://badge5' : 'res://badge5inactive'}}"
                          class="score-image" height="20" width="20" verticalAlignment="center">
                        </Image>
                      </FlexboxLayout>
                    </StackLayout>

                    <StackLayout row="1" colSpan="3" horizontalAlignment="center" class="gamestatus" marginTop="10">
                      <StackLayout *ngIf="
                                    (game.gameOptions?.playerMode != PlayerMode.Single && 
                                     game.round < 16 &&
                                     game.stats[user.userId]?.score > game.stats[otherUserId]?.score)
                                    ||
                                    (game.gameOptions?.playerMode == PlayerMode.Single &&
                                     game.playerQnAs?.length - game.stats[user.userId]?.score !== 4)"
                        orientation="horizontal" margin="15" horizontalAlignment="center">
                        <Label class="gamestatus-username-color Roboto-Bold" text="{{playerUserName}} Won!"
                          textWrap="true" marginLeft="10" horizontalAlignment="center"></Label>
                      </StackLayout>
                      <StackLayout *ngIf="
                                    (game.gameOptions?.playerMode != PlayerMode.Single &&
                                     game.round < 16 &&
                                     game.stats[user.userId]?.score < game.stats[otherUserId]?.score)
                                    ||
                                    (game.gameOptions?.playerMode == PlayerMode.Single &&
                                     game.playerQnAs?.length - game.stats[user.userId]?.score === 4)"
                        orientation="horizontal" margin="15" horizontalAlignment="center">
                        <Label class="gamestatus-username-color Roboto-Bold" color="#F44336"
                          text="{{playerUserName}} Lost" textWrap="true" marginLeft="10"
                          horizontalAlignment="center"></Label>
                      </StackLayout>

                      <StackLayout *ngIf="
                                    (game.gameOptions?.playerMode != PlayerMode.Single &&
                                     game.round < 16 &&
                                     game.stats[user.userId]?.score == game.stats[otherUserId]?.score)"
                        orientation="horizontal" margin="15" horizontalAlignment="center">
                        <Label class="gamestatus-username-color Roboto-Bold" text="It's a Tie" textWrap="true"
                          marginLeft="10"></Label>
                      </StackLayout>

                      <StackLayout *ngIf="
                                    game.gameOptions?.playerMode != PlayerMode.Single &&
                                     game.round === 16" orientation="horizontal" margin="15"
                        horizontalAlignment="center">
                        <Label class="gamestatus-username-color Roboto-Bold" text="It's a Draw" textWrap="true"
                          marginLeft="10"></Label>
                      </StackLayout>

                    </StackLayout>
                  </GridLayout>

                  <GridLayout rows="auto,auto" columns="auto" verticalAlignment="center" horizontalAlignment="center"
                    marginTop="10">
                    <GridLayout horizontalAlignment="center" row="0" col="0">
                      <Label class="bits-n-bites-lable" verticalAlignment="center" marginTop="10"
                        text="{{playerUserName}} {{playerUserName === 'You' ? 'have' : 'has'}} earned" textWrap="true">
                      </Label>
                    </GridLayout>
                    <GridLayout rows="auto" columns="auto,auto,auto,auto" marginTop="12" marginBottom="10" row="1"
                      col="0" verticalAlignment="center">
                      <Image row="0" col="0" src="res://bits" height="32" width="32" padding="20"></Image>
                      <Label row="0" col="1" class="bits-n-bites-lable" verticalAlignment="center" marginLeft="10"
                        text="{{applicationSettings?.tokens?.enable === true && applicationSettings?.tokens?.earn_bits * game.stats[user.userId].score}}"
                        textWrap="true"> </Label>
                      <Image row="0" col="2" src="res://bytes" height="32" width="32" padding="20" marginLeft="20">
                      </Image>
                      <Label row="0" col="3" class="bits-n-bites-lable" verticalAlignment="center"
                        text="{{applicationSettings?.tokens?.enable === true && applicationSettings?.tokens?.earn_bytes *  (game.stats[user.userId].score >=5 ? 1 : 0 ) }}"
                        textWrap="true" marginLeft="10"></Label>
                    </GridLayout>
                  </GridLayout>
                </StackLayout>
              </StackLayout>

              <StackLayout padding="10">
                <GridLayout rows="auto,auto,auto,auto,auto" columns="auto" horizontalAlignment="center">

                  <label row="0" col="0" class="navigate-button-solid Hind-Medium"
                    [text]="game.gameOptions?.playerMode == PlayerMode.Single ? 'Play Again' : 'Invite to play again'"
                    (rippleTap)="reMatchGame()" stlRippleEffect></label>

                  <label row="1" col="0" class="navigate-button-text Hind-Medium" text="GO TO HOME"
                    (rippleTap)="gotoDashboard()" stlRippleEffect></label>

                  <label row="2" col="0" class="navigate-button Hind-Medium" text="Game Summary"
                    (rippleTap)="bindQuestions();showDialog();showQuesAndAnswer=!showQuesAndAnswer;"
                    stlRippleEffect></label>

                  <label row="3" col="0" class="navigate-button Hind-Medium" text="Share with your friends"
                    (rippleTap)="screenshot()" stlRippleEffect></label>

                  <label row="4" col="0" class="navigate-button Hind-Medium" text="Invite as Friend"
                    (rippleTap)="inviteAsFriend()" isEnabled="{{!disableFriendInviteBtn}}"
                    *ngIf="(game.gameOptions.opponentType == opponentType.Random || game.gameOptions.isChallenge ) && otherUserInfo?.email && userInvitations &&  userInvitations[otherUserInfo?.email]?.status === 'add'"
                    stlRippleEffect></label>

                  <label row="4" col="0" class="navigate-button-green Hind-Medium" text="Friend Request Sent"
                    isEnabled="{{!disableFriendInviteBtn}}"
                    *ngIf="(game.gameOptions.opponentType == opponentType.Random || game.gameOptions.isChallenge ) && otherUserInfo?.email && userInvitations && userInvitations[otherUserInfo?.email]?.status === 'pending'"></label>

                  <label row="4" col="0" class="navigate-button-grey Hind-Medium" text="Friends"
                    *ngIf="(game.gameOptions.opponentType == opponentType.Random || game.gameOptions.isChallenge ) && otherUserInfo?.email  && userInvitations && userInvitations[otherUserInfo?.email]?.status === 'approved'"></label>

                </GridLayout>
              </StackLayout>
            </StackLayout>
          </render-box>

        </StackLayout>
      </ScrollView>
      <AbsoluteLayout verticalAlignment="center" horizontalAlignment="center">
        <ActivityIndicator *ngIf="disableRematchBtn" busy="true" ios:width="100" ios:height="50" android:width="50"
          android:height="50" class="activity-indicator"></ActivityIndicator>
      </AbsoluteLayout>
    </GridLayout>
  </StackLayout>

  <StackLayout height="100%" (tap)="preventEventPropogation()" class="dialog__wrapper">
    <AbsoluteLayout width="100%" height="100%">
      <GridLayout rows="200,*" height="100%" width="100%">
        <StackLayout row="1" class="main-dialog">
          <FlexboxLayout class="dialog-title-container">
            <Label text="Game summary" class="dialog-title" textWrap="true"></Label>
            <Label text="&#xf00d;" class="fa close-tag" textWrap="true" (tap)="closeDialog()"></Label>
          </FlexboxLayout>
          <ScrollView height="100%">
            <StackLayout>
              <GridLayout rows="*" columns="auto,*" class="question" *ngFor="let row  of questionsArray;let i=index;">
                <Label row="0" col="0" *ngIf="row?.ansStatus" text="&#xf00c;" verticalAlignment="top"
                  class="fa correct-icon" textWrap="true"></Label>
                <Label row="0" col="0" *ngIf="!row?.ansStatus" text="&#xf00d;" verticalAlignment="top"
                  class="fa wrong-icon" textWrap="true"></Label>
                <StackLayout row="0" col="1" class="question-details" marginRight="20">
                  <Label text="{{row.questionText}}" class="question-content" textWrap="true"></Label>
                  <GridLayout rows="*" columns="*,auto">
                    <StackLayout row="0" col="0">
                      <StackLayout *ngFor="let answer of row.answers">
                        <FlexboxLayout *ngIf="row?.ansStatus && answer.correct">
                          <image src="res://bits" width="30" height="30">
                          </image>
                          <Label class="quetion-bits"
                            text="+{{applicationSettings?.tokens?.enable === true && applicationSettings?.tokens?.earn_bits}}"
                            textWrap="true"></Label>
                        </FlexboxLayout>
                        <Label *ngIf="answer.correct" class="correct-answer"
                          text="Correct Answer: {{answer.answerText}}" textWrap="true"></Label>
                      </StackLayout>
                      <Label *ngIf="!row?.ansStatus" class="your-answer"
                        text="Your Answer: {{row.userGivenAnswer ? row.userGivenAnswer : 'No answer' }}"
                        textWrap="true"></Label>
                    </StackLayout>
                    <StackLayout row="0" col="1" horizontalAlignment="right" verticalAlignment="center">
                      <Button col="3" rowSpan="3" verticalAlignment="center"
                        style="color:#3b444f; border-width:2px; border-color:#f3f3f3; padding:10" text="Report"
                        marginRight="10" *ngIf="!game.playerQnAs[i].isReported" (rippleTap)="openDialog(row)"
                        stlRippleEffect></Button>
                      <Label col="3" rowSpan="3" text="Reported" verticalAlignment="center" marginRight="10" color="red"
                        fontWeight="600" textWrap="true" *ngIf="game.playerQnAs[i]?.isReported"></Label>
                    </StackLayout>
                  </GridLayout>
                </StackLayout>
              </GridLayout>
            </StackLayout>
          </ScrollView>
        </StackLayout>
      </GridLayout>
    </AbsoluteLayout>
  </StackLayout>
</GridLayout>