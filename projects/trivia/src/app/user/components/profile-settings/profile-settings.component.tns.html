<ns-action-bar title="Profile" class="Roboto-Regular" showAdd="true"></ns-action-bar>
<GridLayout rows="*,auto" columns="*">


  <StackLayout row="0" iosOverflowSafeArea="false" class="profileSettings ">
    <ActivityIndicator visibility="{{ loaderBusy ? 'visible' : 'collapsed' }}" [busy]="loaderBusy" width="100"
      height="100" marginTop="225" class="activity-indicator"></ActivityIndicator>
    <ScrollView visibility="{{ !loaderBusy ? 'visible' : 'collapsed' }}" iosOverflowSafeArea="false">
      <PreviousNextView>
        <FlexboxLayout class="profile" (tap)="hideKeyboard()" flexDirection="column" *ngIf="userForm"
          [formGroup]="userForm" iosOverflowSafeArea="false">

          <!-- Profile Image -->
          <StackLayout class="profile_image" iosOverflowSafeArea="false">
            <AbsoluteLayout class="profile_image--center" iosOverflowSafeArea="false" horizontalAlignment="center">
              <Image [src]="profileImage.image" stretch="aspectFill" (tap)="userType ===  0 ? onTakePhoto() : ''">
              </Image>
              <CardView class="profile_image--edit" top="60" left="65" android:elevation="5" ios:elevation="40"
                android:radius="50" ios:radius="18" iosOverflowSafeArea="false">
                <Label textAlignment="center" verticalAlignment="center" (tap)="onTakePhoto()" text="&#xe927;"
                  class="ico icon-edit" textWrap="true"></Label>
              </CardView>
            </AbsoluteLayout>
          </StackLayout>

          <!-- displayName -->
          <StackLayout marginBottom="40">
            <FlexboxLayout justifyContent="center">
              <app-check-display-name formControlName="displayName" hint="Display Name" isProfilePage="true">
              </app-check-display-name>
              <Label *ngIf="!singleFieldEdit.displayName && !isSavingUserName" (tap)="editSingleField('displayName')"
                color="#14418B" fontSize="20" alignSelf="center" class="ico icon-edit" textWrap="true"
                text="&#xe927;"></Label>
              <Label *ngIf="(singleFieldEdit.displayName && userForm.value.displayName !=='') && !isSavingUserName"
                (tap)="onSubmit(true, 'displayName')" alignSelf="center" color="#14418B" fontSize="24" class="fa"
                text="&#xf058;" style="padding:0 5"> </Label>
              <ActivityIndicator *ngIf="isSavingUserName" alignSelf="center" color="#3b5998" ios:width="25"
                ios:height="25" android:width="25" android:height="25" busy="true" class="activity-indicator">
              </ActivityIndicator>
            </FlexboxLayout>

            <FlexboxLayout justifyContent="center" flexWrap="wrap">
              <Label
                *ngIf="userForm.controls.displayName.errors && userForm.controls.displayName.errors.required && !userForm.controls.displayName.pristine"
                class=" error" textWrap="true" text="Display Name is required!"></Label>
              <Label *ngIf="userForm.controls.displayName.errors && userForm.controls.displayName.errors.exist"
                class=" error" textWrap="true" text="Display Name is already taken by other user"></Label>
            </FlexboxLayout>
          </StackLayout>

          <!-- Email -->
          <GridLayout rows="auto,auto" columns="*" margin="5 0">
            <GridLayout row="0" rows="auto" columns="*,auto" borderWidth="2" borderColor="#f2f2f2" borderRadius="5"
              padding="10"
              [ngClass]="{'animate-ease-out': singleFieldEdit.email, 'animate-ease-in': !singleFieldEdit.email}">
              <FlexboxLayout col="0" flexDirection="column" justifyContent="center">
                <Label *ngIf="(!singleFieldEdit.email) && !isSavingUserName" alignSelf="flex-start" text="Email"
                  textWrap="true" class="label-field"></Label>
                <Label *ngIf="!singleFieldEdit.email" [text]="user.email" textWrap="true"
                  class="label-value"></Label>
                <TextField *ngIf="singleFieldEdit.email" hint="Email" formControlName="email">
                </TextField>

              </FlexboxLayout>
              <FlexboxLayout col="1" flexDirection="column" justifyContent="center">
                <Label *ngIf="(!singleFieldEdit.email)" (tap)="editSingleField('email')" color="#14418B"
                  fontSize="20" class="ico icon-edit" textWrap="true" text="&#xe927;" padding="5">
                </Label>
                <Label *ngIf="(singleFieldEdit.email && userForm.value.email !=='')" (tap)="onSubmit(true, 'email')"
                  color="#14418B" fontSize="24" class="fa" text="&#xf058;" padding="5">
                </Label>
              </FlexboxLayout>
            </GridLayout>
            <StackLayout width="90%" row="1">
              <Label *ngIf="userForm.controls.email.errors?.required && !userForm.controls.email.pristine"
                class=" error" textWrap="true" text="Email is required!"></Label>

              <Label *ngIf="userForm.controls.email.errors?.email && !userForm.controls.email.pristine" class="error"
                textWrap="true" text="Email is Invalid!"></Label>
            </StackLayout>
          </GridLayout>

          <!-- Phone No -->
          <GridLayout rows="auto,auto" columns="*" margin="5 0">
            <GridLayout row="0" rows="auto" columns="*,auto" borderWidth="2" borderColor="#f2f2f2" borderRadius="5"
              padding="10"
              [ngClass]="{'animate-ease-out': singleFieldEdit.phoneNo, 'animate-ease-in': !singleFieldEdit.phoneNo}">
              <FlexboxLayout col="0" flexDirection="column" justifyContent="center">
                <Label *ngIf="(!singleFieldEdit.phoneNo) && !isSavingUserName" alignSelf="flex-start" text="Phone"
                  textWrap="true" class="label-field"></Label>
                <Label *ngIf="!singleFieldEdit.phoneNo" [text]="user.phoneNo" textWrap="true"
                  class="label-value"></Label>
                <TextField *ngIf="singleFieldEdit.phoneNo" hint="Phone" formControlName="phoneNo">
                </TextField>

              </FlexboxLayout>
              <FlexboxLayout col="1" flexDirection="column" justifyContent="center">
                <Label *ngIf="(!singleFieldEdit.phoneNo)" (tap)="editSingleField('phoneNo')" color="#14418B"
                  fontSize="20" class="ico icon-edit" textWrap="true" text="&#xe927;" padding="5">
                </Label>
                <Label *ngIf="(singleFieldEdit.phoneNo && userForm.value.phoneNo !=='')"
                  (tap)="onSubmit(true, 'phoneNo')" color="#14418B" fontSize="24" class="fa" text="&#xf058;"
                  padding="5">
                </Label>
              </FlexboxLayout>
            </GridLayout>
            <StackLayout width="90%" row="1"
              *ngIf="userForm.controls.phoneNo.errors?.pattern && !userForm.controls.phoneNo.pristine">
              <Label class="error" textWrap="true" text="phoneNo is Invalid!"></Label>
            </StackLayout>
          </GridLayout>

          <!-- Password -->
          <FlexboxLayout margin="5 0" justifyContent="space-between" orientation="horizontal" borderRadius="5"
            class="edit-field" *ngIf="currentAuthProvider===authProviderConstants.PASSWORD">
            <FlexboxLayout flexDirection="column">
              <Label alignSelf="flex-start" text="Password" textWrap="true" class="label-field"></Label>
              <Label alignSelf="flex-start" text="XXXXXX" textWrap="true" class="label-value"></Label>
            </FlexboxLayout>
            <Label alignSelf="center" color="#14418B" fontSize="20" class="ico icon-edit" textWrap="true"
              text="&#xe927;" (tap)="redirectToChangePassword()" padding="5"></Label>
          </FlexboxLayout>

          <!-- Location -->
          <GridLayout rows="auto" columns="*" margin="5 0">
            <FlexboxLayout row="0" justifyContent="space-between" borderWidth="2" class="second-view"
              borderColor="#f2f2f2" borderRadius="5" padding="10"
              [ngClass]="{'animate-ease-out': singleFieldEdit.location && activeEditField === 'location', 'animate-ease-in': !singleFieldEdit.location && activeEditField === 'location'}"
              >
              <FlexboxLayout flexDirection="column" justifyContent="center">
                <Label *ngIf="(!singleFieldEdit.location) && !isSavingUserName" alignSelf="flex-start" text="Location"
                  textWrap="true" class="label-field"></Label>
                <Label *ngIf="!singleFieldEdit.location" [text]="user.location" textWrap="true"
                  class="label-value"></Label>
                <RadAutoCompleteTextView [visibility]="singleFieldEdit.location ? 'visible' : 'collapsed'" #acLocation
                  [items]="dataLocation" suggestMode="Suggest" showCloseButton="false"
                  (didAutoComplete)="onTextChangedLocation($event)" (textChanged)="onTextChangedLocation($event)"
                  borderWidth="0 0 2 0" borderColor="#D3D3D3" width="280" (loaded)="onLoadedLoaction($event)">
                  <SuggestionView tkAutoCompleteSuggestionView marginTop="20">
                    <ng-template tkSuggestionItemTemplate let-item="item">
                      <StackLayout orientation="vertical" padding="10">
                        <Label [text]="item.text"></Label>
                      </StackLayout>
                    </ng-template>
                  </SuggestionView>
                </RadAutoCompleteTextView>

              </FlexboxLayout>
              <FlexboxLayout flexDirection="column" justifyContent="center">
                <Label *ngIf="(!singleFieldEdit.location)" (tap)="editLocationField()" color="#14418B" fontSize="20"
                  class="ico icon-edit" textWrap="true" text="&#xe927;" padding="5">
                </Label>
                <Label *ngIf="(singleFieldEdit.location && userForm.value.location !=='')"
                  (tap)="onSubmit(true, 'location')" color="#14418B" fontSize="24" class="fa" text="&#xf058;"
                  style="padding:0 5"> </Label>
              </FlexboxLayout>
            </FlexboxLayout>
          </GridLayout>

          <!-- Social Handles -->
          <StackLayout class="list-view social-section" iosOverflowSafeArea="false" marginTop="5" marginBottom="40"
            *ngIf="socialProfileSettings && socialProfileSettings.length > 0" class="edit-field">
            <FlexboxLayout class="grid-label p-15" justifyContent="space-between" iosOverflowSafeArea="false">
              <Label textWrap="true" text="Social Handles"></Label>
              <Label *ngIf="!singleFieldEdit.socialProfile" alignSelf="center" color="#14418B" fontSize="20"
                class="ico icon-edit" textWrap="true" text="&#xe927;" stlRippleEffect
                (rippleTap)="editSingleField('socialProfile');" padding="5">
              </Label>
              <Label alignSelf="center" *ngIf="singleFieldEdit.socialProfile" (tap)="onSubmit(false, 'socialProfile');"
                color="#14418B" fontSize="24" class="fa" text="&#xf058;" padding="5">
              </Label>
            </FlexboxLayout>
            <StackLayout class="input-field" *ngFor="let profile of socialProfileSettings; let i=index"
              iosOverflowSafeArea="false">
              <GridLayout rows="auto" columns="auto, *" *ngIf="profile?.enable" [order]="profile?.position"
                padding="10 0">
                <Label verticalAlignment="center" row="0" col="0" text="{{getIcon(profile?.icon)}}" fontSize="22"
                  margin="0 5 0 5" paddingRight="15" class="fa text-black"></Label>
                <TextField row="0" col="1" width="100%" hint="username" [editable]="profile?.disable"
                  [formControlName]="profile.social_name">
                </TextField>
                <Label *ngIf="userForm.get(profile.social_name).errors" class="error"
                  text="Please enter valid profile id" textWrap="true"></Label>
              </GridLayout>

              <GridLayout *ngIf="userType !== 0 && profile.enable" rows="auto,*" columns="*"
                iosOverflowSafeArea="false">
                <Label class="grid-label-text" [text]="profile.display" row="0" col="0" textWrap="true"></Label>
                <StackLayout marginLeft="14" marginTop="8" row="1" col="0" orientation="horizontal"
                  iosOverflowSafeArea="false">
                  <Label class="grid-label-text"
                    (tap)="openUrl(profile?.url, userForm.get([profile.social_name]).value)" color="blue"
                    text="{{profile?.url}}{{userForm.get([profile.social_name]).value}}" textWrap="true"></Label>
                </StackLayout>
              </GridLayout>
            </StackLayout>
          </StackLayout>

          <Label text="PROVIDE FEEDBACK" stlRippleEffect (rippleTap)="navigateToUserFeedback()" color="#14418B"
            fontSize="18" padding="10" textWrap="true"></Label>
          <Label text="PRIVACY POLICY" stlRippleEffect (rippleTap)="navigateToPrivacyPolicy()" color="#14418B"
            fontSize="18" padding="10" textWrap="true"></Label>
          <Label text="TERMS & CONDITIONS" stlRippleEffect (rippleTap)="navigateToTermsConditions()" color="#14418B"
            fontSize="18" padding="10" textWrap="true"></Label>

        </FlexboxLayout>
      </PreviousNextView>
    </ScrollView>
  </StackLayout>

  <Absolutelayout *ngIf="platform.isIOS" row="1" verticalAlignment="bottom">
    <bottom-bar [screen]="'profile-settings'">
    </bottom-bar>
  </Absolutelayout>
</GridLayout>